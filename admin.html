<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - KIWI Telecom</title>
  <link rel="stylesheet" href="src/output.css" />
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
  <header class="flex items-center justify-between px-6 py-4 bg-white shadow-md sticky top-0 z-40">
    <a href="index.html" class="text-xl font-bold text-blue-600">KIWI Telecom</a>
    <nav class="flex items-center gap-4">
      <button id="logoutBtn" class="hidden text-sm text-red-600 hover:text-red-700">Logout</button>
      <a href="index.html" class="text-sm text-gray-600 hover:text-blue-600">Home</a>
    </nav>
  </header>

  <!-- Login Gate -->
  <section id="adminLogin" class="max-w-md mx-auto p-4 sm:p-6 lg:p-8">
    <div class="bg-white shadow rounded-lg p-5 sm:p-6">
      <h1 class="text-xl font-semibold mb-4">Admin Login</h1>
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="adminPassword" class="block text-sm font-medium mb-1">Password</label>
          <div class="flex">
            <input id="adminPassword" type="password" class="flex-1 border rounded-l-lg p-2" placeholder="Enter password" required />
            <button type="button" id="togglePwd" class="border border-l-0 rounded-r-lg px-3 text-sm text-gray-600">Show</button>
          </div>
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Login</button>
        <p id="loginError" class="hidden text-sm text-red-600">Incorrect password. Please try again.</p>
      </form>
      <p class="text-xs text-gray-500 mt-3">Note: This is a client-side password gate for demo use only.</p>
    </div>
  </section>

  <main id="adminApp" class="max-w-3xl mx-auto p-4 sm:p-6 lg:p-8 hidden">
    <h1 class="text-2xl font-bold mb-6">Admin Panel</h1>

    <div class="bg-white shadow rounded-lg p-4 sm:p-6">
      <h2 class="text-lg font-semibold mb-4">Add Product</h2>
      <form id="productForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1" for="category">Category</label>
          <select id="category" class="w-full border rounded-lg p-2">
            <option value="dataCables">Data Cables</option>
            <option value="chargers">Chargers</option>
            <option value="earphones">Earphones</option>
            <option value="earbuds">Earbuds</option>
            <option value="neckbands">Neckbands</option>
            <option value="speakers">Speaker</option>
            <option value="powerbankCables">Powerbank Cables</option>
            <option value="batteries">Batteries</option>
            <option value="powerbanks">Powerbanks</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" for="name">Product Name</label>
          <input id="name" class="w-full border rounded-lg p-2" placeholder="e.g., Premium Data Cable" required />
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1" for="price">Price (₹)</label>
            <input id="price" type="number" min="0" class="w-full border rounded-lg p-2" placeholder="e.g., 299" required />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" for="imageUrl">Image URL (optional)</label>
            <input id="imageUrl" class="w-full border rounded-lg p-2" placeholder="https://..." />
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Or Upload Image</label>
          <input id="imageFile" type="file" accept="image/*" class="w-full" />
          <p class="text-xs text-gray-500 mt-1">If both URL and upload are provided, uploaded image will be used.</p>
        </div>
        
        <div class="flex items-center gap-3">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Add Product</button>
          <span id="status" class="text-sm text-gray-600"></span>
        </div>
      </form>
    </div>

    <div class="mt-8 bg-white shadow rounded-lg p-4 sm:p-6">
      <h2 class="text-lg font-semibold mb-4">Preview (Last Added)</h2>
      <div id="preview" class="text-sm text-gray-600">No product added yet.</div>
      <p class="text-xs text-gray-500 mt-2">After adding, open Home or the category page to see it live.</p>
    </div>
  </main>

  <script src="script.js"></script>
  <script>
    // Simple client-side password gate
    const ADMIN_PASSWORD = 'kiwi@123'; // Change this to your desired password
    const loginSection = document.getElementById('adminLogin');
    const appSection = document.getElementById('adminApp');
    const loginForm = document.getElementById('loginForm');
    const adminPassword = document.getElementById('adminPassword');
    const loginError = document.getElementById('loginError');
    const togglePwd = document.getElementById('togglePwd');
    const logoutBtn = document.getElementById('logoutBtn');

    function setAuthed(authed) {
      if (authed) {
        sessionStorage.setItem('adminAuthed', 'true');
        loginSection.classList.add('hidden');
        appSection.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
      } else {
        sessionStorage.removeItem('adminAuthed');
        appSection.classList.add('hidden');
        loginSection.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
      }
    }

    // On load: check session
    if (sessionStorage.getItem('adminAuthed') === 'true') {
      setAuthed(true);
    } else {
      setAuthed(false);
    }

    // Toggle password visibility
    togglePwd.addEventListener('click', () => {
      if (adminPassword.type === 'password') {
        adminPassword.type = 'text';
        togglePwd.textContent = 'Hide';
      } else {
        adminPassword.type = 'password';
        togglePwd.textContent = 'Show';
      }
    });

    // Handle login
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      loginError.classList.add('hidden');
      if (adminPassword.value === ADMIN_PASSWORD) {
        setAuthed(true);
        adminPassword.value = '';
      } else {
        loginError.classList.remove('hidden');
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      setAuthed(false);
    });

    const form = document.getElementById('productForm');
    const statusEl = document.getElementById('status');
    const previewEl = document.getElementById('preview');

    async function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';

      const category = document.getElementById('category').value;
      const name = document.getElementById('name').value;
      const priceRaw = document.getElementById('price').value;
      const price = priceRaw ? `₹${priceRaw}` : '';
      const imageUrl = document.getElementById('imageUrl').value.trim();
      const imageFile = document.getElementById('imageFile').files[0];

      let image = imageUrl;
      if (imageFile) {
        try {
          image = await fileToDataUrl(imageFile);
        } catch (err) {
          console.error('Image upload failed', err);
          statusEl.textContent = 'Image upload failed, using URL if provided.';
        }
      }

      addProduct(category, { name, price, image });

      statusEl.textContent = 'Product added successfully!';
      previewEl.innerHTML = `
        <div class="bg-white rounded-xl shadow p-4 flex flex-col items-center">
          ${image ? `<img src="${image}" alt="${name}" class="h-36 w-full object-contain mb-3">` : ''}
          <h3 class="font-semibold">${name}</h3>
          <p class="text-blue-600 font-bold mt-1">${price}</p>
          <p class="text-xs text-gray-500 mt-2">Category: ${category}</p>
        </div>
      `;

      form.reset();
    });
  </script>
</body>
</html>
